---
title: "ICOW.jl"
subtitle: "Island City on a Wedge"
author: "James Doss-Gollin"
bibliography: references.bib
engine: julia
execute:
  code-fold: true
format:
  html:
    fig-format: svg
---

::: {.callout-warning}
## Work in Progress

This package is under active development and the API may change.
:::

## What is iCOW?

ICOW.jl is a Julia implementation of the "Island City on a Wedge" (iCOW) model from @ceres_cityonawedge:2019.
It is a **storm surge risk modeling framework of intermediate complexity** designed for analyzing flood risk management decisions.

### Why iCOW?

iCOW bridges the gap between two extremes in flood risk modeling:

| Model Type | Pros | Cons |
|------------|------|------|
| **Simple models** (van Dantzig style) | Fast, analytical | Single strategy (dikes only), binary damage |
| **Regional models** (CLARA style) | Realistic, site-specific | Computationally expensive, requires extensive data |
| **iCOW** | Fast enough for optimization | Captures multiple strategies and realistic damage |

Simple models like @vandantzig_dike:1956 assume dikes either hold (zero damage) or fail (100% damage).
This misses the reality that flooding causes **graduated damage** depending on depth and extent.
Regional models capture this complexity but require extensive site-specific data and computational resources.

iCOW provides a middle ground: it's computationally efficient enough to evaluate millions of strategy combinations while capturing the key physics that drive risk-cost tradeoffs.

## SimOptDecisions Framework

ICOW.jl uses the [SimOptDecisions.jl](https://dossgollin-lab.github.io/SimOptDecisions/) framework for sequential decision-making under uncertainty.
Understanding a few key concepts will help you use the package effectively:

| Concept | In iCOW | Description |
|---------|---------|-------------|
| **Config** | `StochasticConfig` / `EADConfig` | City parameters the decision-maker cannot control (28 physical constants) |
| **Scenario** | `StochasticScenario` / `EADScenario` | Uncertainty representation (surge sequences or distributions) |
| **Policy** | `StaticPolicy` | A rule for choosing flood defenses; reparameterized for optimization |
| **State** | `StochasticState` / `EADState` | Current protection levels (tracks `FloodDefenses`) |
| **Outcome** | `StochasticOutcome` / `EADOutcome` | Final result: investment cost + damage |

This separation enables:

- **Modularity**: Swap forcing scenarios without changing policy logic
- **Optimization**: Tune policy parameters to minimize objectives
- **Extensibility**: Add adaptive policies that respond to observed storms

See the [SimOptDecisions documentation](https://dossgollin-lab.github.io/SimOptDecisions/) for more on the underlying framework.

## Simulation Modes

ICOW supports two simulation modes for evaluating policies:

| Mode | How It Works | Best For |
|------|--------------|----------|
| **EAD** | Integrates damage over the surge distribution (analytical inner expectation) | Rapid optimization, risk-neutral policy comparison |
| **Stochastic** | Simulates realized damage from sampled surge sequences with stochastic dike failure | Tail risk (99th percentile loss), robustness analysis |

Both modes converge to the same expected values by the Law of Large Numbers.
The key difference is that Stochastic mode reveals the **variance** and **tail behavior** of outcomes.

::: {.callout-tip}
## Choosing a Mode

Use **EAD mode** when you want fast, deterministic expected values for optimization or screening many policies.

Use **Stochastic mode** when you care about the distribution of outcomes or when you want to design realistic adaptive policies.
:::

## The Wedge Geometry

The model represents a coastal city as an **island on a wedge-shaped terrain** that rises from sea level.
This geometry, inspired by areas like Manhattan's South Street Seaport, captures a key physical reality:

**Higher storm surges cause more damage in two ways:**

1. **Larger flooded area** -- water reaches further inland on the slope
2. **Deeper flooding** -- buildings at low elevations experience greater depth

This creates nonlinear damage relationships that simple models miss.
The wedge approximation applies to any coastal city where terrain rises from the waterfront.

Decision-makers invest in three types of protection -- withdrawal, resistance (flood-proofing), and dikes -- which divide the city into five elevation zones with different damage behavior.
See the [Equations](core/equations.qmd) page for the full mathematical formulation.

## Installation

Requires Julia 1.10 or later.

```julia
using Pkg
Pkg.add(url="https://github.com/dossgollin-lab/ICOW.jl")
```

## Quick Example

```julia
using ICOW.EAD
using Distributions
using Random

# City with default parameters
config = EADConfig()

# 50 years of stationary Normal-distributed annual maximum surges
dists = [Normal(3.0, 1.0) for _ in 1:50]
scenario = EADScenario(dists, 0.03, QuadratureIntegrator())

# Protection strategy: moderate dike + some resistance
policy = StaticPolicy(a_frac=0.3, w_frac=0.0, b_frac=0.2, r_frac=0.1, P=0.5)

# Run simulation
rng = MersenneTwister(42)
outcome = simulate(config, scenario, policy, rng)

# Results (value() extracts numeric values from outcome fields)
println("Investment: \$$(round(value(outcome.investment) / 1e9, digits=2))B")
println("Expected damage: \$$(round(value(outcome.expected_damage) / 1e9, digits=2))B")
println("Total cost: \$$(round(total_cost(outcome) / 1e9, digits=2))B")
```

The `StaticPolicy` uses a stick-breaking reparameterization to guarantee all physical constraints are satisfied.
See [Architecture](core/architecture.qmd) for details on how policy fractions map to `FloodDefenses`.

## Next Steps

- [Equations](core/equations.qmd) -- Full mathematical formulation
- [Architecture](core/architecture.qmd) -- Module structure and type system
- [EAD Details](ead/details.qmd) -- Expected annual damage mode walkthrough
- [Stochastic Details](stochastic/details.qmd) -- Stochastic simulation mode walkthrough
- [API Reference](api/core.qmd) -- Function signatures and docstrings

## References
