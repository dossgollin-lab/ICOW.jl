---
title: "ICOW.jl"
subtitle: "Island City on a Wedge"
author: "James Doss-Gollin"
bibliography: references.bib
engine: julia
---

::: {.callout-warning}
## Work in Progress

This package is under active development and the API may change.
:::

## What is iCOW?

Coastal cities face a difficult decision problem: how much to invest in flood protection, and what combination of strategies to use.
The answer depends on uncertain future storm hazards, the cost structures of different interventions, and the decision-maker's tolerance for risk [@keller_management:2021].

ICOW.jl is a Julia implementation of the "Island City on a Wedge" (iCOW) model from @ceres_cityonawedge:2019.
It provides a **flood risk modeling framework of intermediate complexity** -- fast enough to evaluate millions of strategy combinations, yet rich enough to capture the nonlinear interactions between withdrawal, resistance, and dike protection that simpler models miss.

::: {.callout-note}
## Who Is This For?

This package is designed for researchers and students working on **climate risk management** and **decision making under uncertainty**.
If you study how communities should invest in flood protection under uncertain hazards, iCOW provides a fast, transparent test bed for exploring strategy portfolios and their sensitivity to assumptions.
No prior flood modeling experience is needed -- the [Background](getting-started/background.qmd) page introduces the physical concepts.
:::

### Why iCOW?

iCOW bridges the gap between two extremes in flood risk modeling:

| Model Type | Pros | Cons |
|------------|------|------|
| **Simple models** (van Dantzig style) | Fast, analytical | Single strategy (dikes only), binary damage |
| **Regional models** | Realistic, site-specific | Computationally expensive, requires extensive data |
| **iCOW** | Fast enough for optimization | Captures multiple strategies and realistic damage |

Simple models like @vandantzig_dike:1956 assume dikes either hold (zero damage) or fail (100% damage).
This misses the reality that flooding causes **graduated damage** depending on depth and extent.
Regional models capture this complexity but require extensive site-specific data and computational resources.

iCOW provides a middle ground: it's computationally efficient enough to evaluate millions of strategy combinations while capturing the key physics that drive risk-cost tradeoffs.

## SimOptDecisions Framework

ICOW.jl uses the [SimOptDecisions.jl](https://dossgollin-lab.github.io/SimOptDecisions/) framework for sequential decision-making under uncertainty.
If you are new to SimOptDecisions, here is a brief overview of its key concepts as they appear in iCOW:

| Concept | In iCOW | Description |
|---------|---------|-------------|
| **Config** | `StochasticConfig` / `EADConfig` | City parameters the decision-maker cannot control (28 physical constants) |
| **Scenario** | `StochasticScenario` / `EADScenario` | Uncertainty representation (surge sequences or GEV parameters) |
| **Policy** | `StaticPolicy` | A rule for choosing flood defenses; reparameterized for optimization |
| **State** | `StochasticState` / `EADState` | Current protection levels (tracks `FloodDefenses`) |
| **Outcome** | `StochasticOutcome` / `EADOutcome` | Final result: investment cost + damage |

This separation enables:

- **Modularity**: Swap forcing scenarios without changing policy logic
- **Exploration**: Use `explore()` to evaluate many policies across many scenarios
- **Extensibility**: Add adaptive policies that respond to observed storms

See the [SimOptDecisions documentation](https://dossgollin-lab.github.io/SimOptDecisions/) for more on the underlying framework.

## Simulation Modes

ICOW supports two simulation modes for evaluating policies:

| Mode | How It Works | Best For |
|------|--------------|----------|
| **EAD** | Integrates damage over the surge distribution (analytical inner expectation) | Rapid optimization, risk-neutral policy comparison |
| **Stochastic** | Simulates realized damage from sampled surge sequences with stochastic dike failure | Tail risk (99th percentile loss), robustness analysis |

Both modes converge to the same expected values by the Law of Large Numbers.
The key difference is that Stochastic mode reveals the **variance** and **tail behavior** of outcomes.

::: {.callout-tip}
## Choosing a Mode

Use **EAD mode** when you want fast, deterministic expected values for comparing strategies or sweeping over scenarios.

Use **Stochastic mode** when you care about the distribution of outcomes -- e.g., how often a strategy leads to catastrophic losses.
:::

## Installation

Requires Julia 1.10 or later.

```julia
using Pkg
Pkg.add(url="https://github.com/dossgollin-lab/ICOW.jl")
```

## Quick Example

```julia
using ICOW.EAD
using Random

# City with default parameters (100 years, quadrature integration)
config = EADConfig()

# GEV surge distribution (The Battery, NYC) + 1 cm/yr sea level rise
n_years = config.n_years
scenario = EADScenario(;
    surge_loc=0.935, surge_scale=0.260, surge_shape=0.030,
    discount_rate=0.02, mean_sea_level=collect(range(0.0; step=0.01, length=n_years)),
)

# Protection strategy: moderate dike + some resistance
policy = StaticPolicy(; a_frac=0.3, w_frac=0.0, b_frac=0.2, r_frac=0.1, P=0.5)

# Run simulation
rng = MersenneTwister(42)
outcome = simulate(config, scenario, policy, rng)

# Results (value() extracts numeric values from outcome fields)
value(outcome.investment)       # investment cost ($)
value(outcome.expected_damage)  # expected flood damage ($)
total_cost(outcome)             # investment + expected damage ($)
```

The `StaticPolicy` uses a stick-breaking reparameterization to guarantee all physical constraints are satisfied.
See [Architecture](core/architecture.qmd) for details on how policy fractions map to `FloodDefenses`.

## Next Steps

**New to iCOW or flood risk modeling?** Start here:

- [Background](getting-started/background.qmd) -- Physical motivation and real-world strategies
- [Tutorial](getting-started/tutorial.qmd) -- Hands-on walkthrough of a complete analysis
- [Assumptions & Scope](getting-started/assumptions.qmd) -- What the model can and cannot represent

**Ready to dive into the details?**

- [Equations](core/equations.qmd) -- Full mathematical formulation
- [Architecture](core/architecture.qmd) -- Module structure and type system
- [EAD Walkthrough](ead/details.qmd) -- Expected annual damage mode
- [Stochastic Walkthrough](stochastic/details.qmd) -- Stochastic simulation mode
- [API Reference](api/core.qmd) -- Function signatures and docstrings

## References
